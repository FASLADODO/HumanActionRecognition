<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">keyPoints</span> = getKeyPoints(<span class="var type1" id="S3T2U6">I</span>, <span class="var type1" id="S4T3U7">o</span>, <span class="var type1" id="S5T3U8">thresh</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line">coder.varsize(<span class="string">'keyPoints'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T1:U5"><span class="var type1" id="S2T1U17">keyPoints</span> = <span class="mxinfo " id="T4:U7">zeros(<span class="mxinfo " id="T3:U8">0</span>,<span class="mxinfo " id="T3:U9">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T3:U10">[<span class="var type1" id="S8T3U25">height</span>, <span class="var type1" id="S9T3U26">width</span>, <span class="var type1" id="S10T3U27">frames</span>, <span class="var type1" id="S11T3U28">scales</span>] = size(<span class="var type1" id="S3T2U31">I</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S13T3U34">s</span> = <span class="mxinfo " id="T3:U17">3</span> : <span class="mxinfo " id="T3:U18"><span class="var type1" id="S11T3U38">scales</span> - <span class="mxinfo " id="T3:U20">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S14T3U42">h</span> = <span class="mxinfo " id="T3:U22">3</span> : <span class="mxinfo " id="T3:U23"><span class="var type1" id="S8T3U46">height</span> - <span class="mxinfo " id="T3:U25">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S15T3U50">w</span> = <span class="mxinfo " id="T3:U27">3</span> : <span class="mxinfo " id="T3:U28"><span class="var type1" id="S9T3U54">width</span> - <span class="mxinfo " id="T3:U30">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S16T3U58">f</span> = <span class="mxinfo " id="T3:U32">3</span> : <span class="mxinfo " id="T3:U33"><span class="var type1" id="S10T3U62">frames</span> - <span class="mxinfo " id="T3:U35">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T5:U36"><span class="mxinfo " id="T3:U37"><span class="var type1" id="S3T2U68">I</span>(<span class="var type1" id="S14T3U69">h</span>,<span class="var type1" id="S15T3U70">w</span>,<span class="var type1" id="S16T3U71">f</span>,<span class="var type1" id="S13T3U72">s</span>)</span> &gt; <span class="var type1" id="S5T3U73">thresh</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">                    <span class="mxinfo " id="T6:U44"><span class="var type1" id="S17T6U76">prevScale</span> = <span class="mxinfo " id="T6:U46"><span class="var type1" id="S3T2U78">I</span>(<span class="mxinfo " id="T7:U48"><span class="mxinfo " id="T3:U49"><span class="var type1" id="S14T3U81">h</span>-1</span>:<span class="mxinfo " id="T3:U51"><span class="var type1" id="S14T3U84">h</span>+1</span></span>,<span class="mxinfo " id="T7:U53"><span class="mxinfo " id="T3:U54"><span class="var type1" id="S15T3U88">w</span>-1</span>:<span class="mxinfo " id="T3:U56"><span class="var type1" id="S15T3U91">w</span>+1</span></span>,<span class="mxinfo " id="T7:U58"><span class="mxinfo " id="T3:U59"><span class="var type1" id="S16T3U95">f</span>-1</span>:<span class="mxinfo " id="T3:U61"><span class="var type1" id="S16T3U98">f</span>+1</span></span>,<span class="mxinfo " id="T3:U63"><span class="var type1" id="S13T3U101">s</span>-<span class="mxinfo " id="T3:U65">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">                    <span class="mxinfo " id="T6:U66"><span class="var type1" id="S18T6U105">nextScale</span> = <span class="mxinfo " id="T6:U68"><span class="var type1" id="S3T2U107">I</span>(<span class="mxinfo " id="T7:U70"><span class="mxinfo " id="T3:U71"><span class="var type1" id="S14T3U110">h</span>-1</span>:<span class="mxinfo " id="T3:U73"><span class="var type1" id="S14T3U113">h</span>+1</span></span>,<span class="mxinfo " id="T7:U75"><span class="mxinfo " id="T3:U76"><span class="var type1" id="S15T3U117">w</span>-1</span>:<span class="mxinfo " id="T3:U78"><span class="var type1" id="S15T3U120">w</span>+1</span></span>,<span class="mxinfo " id="T7:U80"><span class="mxinfo " id="T3:U81"><span class="var type1" id="S16T3U124">f</span>-1</span>:<span class="mxinfo " id="T3:U83"><span class="var type1" id="S16T3U127">f</span>+1</span></span>,<span class="mxinfo " id="T3:U85"><span class="var type1" id="S13T3U130">s</span>+<span class="mxinfo " id="T3:U87">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">                    <span class="mxinfo " id="T8:U88"><span class="var type1" id="S19T8U134">currScaleNextFrame</span> = <span class="mxinfo " id="T8:U90"><span class="var type1" id="S3T2U136">I</span>(<span class="mxinfo " id="T7:U92"><span class="mxinfo " id="T3:U93"><span class="var type1" id="S14T3U139">h</span>-1</span>:<span class="mxinfo " id="T3:U95"><span class="var type1" id="S14T3U142">h</span>+1</span></span>,<span class="mxinfo " id="T7:U97"><span class="mxinfo " id="T3:U98"><span class="var type1" id="S15T3U146">w</span>-1</span>:<span class="mxinfo " id="T3:U100"><span class="var type1" id="S15T3U149">w</span>+1</span></span>,<span class="mxinfo " id="T3:U102"><span class="var type1" id="S16T3U152">f</span>+<span class="mxinfo " id="T3:U104">1</span></span>,<span class="var type1" id="S13T3U154">s</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">                    <span class="mxinfo " id="T8:U106"><span class="var type1" id="S20T8U157">currScalePrevFrame</span> = <span class="mxinfo " id="T8:U108"><span class="var type1" id="S3T2U159">I</span>(<span class="mxinfo " id="T7:U110"><span class="mxinfo " id="T3:U111"><span class="var type1" id="S14T3U162">h</span>-1</span>:<span class="mxinfo " id="T3:U113"><span class="var type1" id="S14T3U165">h</span>+1</span></span>,<span class="mxinfo " id="T7:U115"><span class="mxinfo " id="T3:U116"><span class="var type1" id="S15T3U169">w</span>-1</span>:<span class="mxinfo " id="T3:U118"><span class="var type1" id="S15T3U172">w</span>+1</span></span>,<span class="mxinfo " id="T3:U120"><span class="var type1" id="S16T3U175">f</span>-<span class="mxinfo " id="T3:U122">1</span></span>,<span class="var type1" id="S13T3U177">s</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">                    <span class="mxinfo " id="T9:U124"><span class="var type1" id="S21T9U180">currScaleCurrFrame</span> = <span class="mxinfo " id="T9:U126">[<span class="mxinfo " id="T10:U127"><span class="var type1" id="S3T2U184">I</span>(<span class="mxinfo " id="T3:U129"><span class="var type1" id="S14T3U186">h</span>-<span class="mxinfo " id="T3:U131">1</span></span>,<span class="mxinfo " id="T7:U132"><span class="mxinfo " id="T3:U133"><span class="var type1" id="S15T3U190">w</span>-1</span>:<span class="mxinfo " id="T3:U135"><span class="var type1" id="S15T3U193">w</span>+1</span></span>,<span class="var type1" id="S16T3U195">f</span>,<span class="var type1" id="S13T3U196">s</span>)</span> <span class="mxinfo " id="T10:U139"><span class="var type1" id="S3T2U198">I</span>(<span class="mxinfo " id="T3:U141"><span class="var type1" id="S14T3U200">h</span>+<span class="mxinfo " id="T3:U143">1</span></span>,<span class="mxinfo " id="T7:U144"><span class="mxinfo " id="T3:U145"><span class="var type1" id="S15T3U204">w</span>-1</span>:<span class="mxinfo " id="T3:U147"><span class="var type1" id="S15T3U207">w</span>+1</span></span>,<span class="var type1" id="S16T3U209">f</span>,<span class="var type1" id="S13T3U210">s</span>)</span> <span class="mxinfo " id="T3:U151"><span class="var type1" id="S3T2U212">I</span>(<span class="var type1" id="S14T3U213">h</span>,<span class="mxinfo " id="T3:U154"><span class="var type1" id="S15T3U215">w</span>-<span class="mxinfo " id="T3:U156">1</span></span>,<span class="var type1" id="S16T3U217">f</span>,<span class="var type1" id="S13T3U218">s</span>)</span> <span class="mxinfo " id="T3:U159"><span class="var type1" id="S3T2U220">I</span>(<span class="var type1" id="S14T3U221">h</span>,<span class="mxinfo " id="T3:U162"><span class="var type1" id="S15T3U223">w</span>+<span class="mxinfo " id="T3:U164">1</span></span>,<span class="var type1" id="S16T3U225">f</span>,<span class="var type1" id="S13T3U226">s</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">                    <span class="comment">%% RESHAPING NEIGHBORHOOD ARRAYS TO ROW MATRICES</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">                    <span class="mxinfo " id="T11:U167"><span class="var type1" id="S22T11U229">pSet</span> = <span class="mxinfo " id="T11:U169">reshape(<span class="var type1" id="S17T6U232">prevScale</span>,[1,27])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">                    <span class="mxinfo " id="T11:U171"><span class="var type1" id="S24T11U239">nSet</span> = <span class="mxinfo " id="T11:U173">reshape(<span class="var type1" id="S18T6U242">nextScale</span>,[1,27])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">                    <span class="mxinfo " id="T12:U175"><span class="var type1" id="S25T12U249">cnfSet</span> = <span class="mxinfo " id="T12:U177">reshape(<span class="var type1" id="S19T8U252">currScaleNextFrame</span>,[1,9])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">                    <span class="mxinfo " id="T12:U179"><span class="var type1" id="S26T12U259">cpfSet</span> = <span class="mxinfo " id="T12:U181">reshape(<span class="var type1" id="S20T8U262">currScalePrevFrame</span>,[1,9])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">                    <span class="mxinfo " id="T9:U183"><span class="var type1" id="S27T9U269">ccfSet</span> = <span class="mxinfo " id="T9:U185">reshape(<span class="var type1" id="S21T9U272">currScaleCurrFrame</span>,[1,8])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">                    <span class="comment">%% CREATING NEIGHBORHOOD ARRAY</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">                    <span class="mxinfo " id="T13:U187"><span class="var type1" id="S28T13U279">tempSet</span> = <span class="mxinfo " id="T13:U189">[<span class="var type1" id="S22T11U282">pSet</span> <span class="var type1" id="S24T11U283">nSet</span> <span class="var type1" id="S25T12U284">cnfSet</span> <span class="var type1" id="S26T12U285">cpfSet</span> <span class="var type1" id="S27T9U286">ccfSet</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">                    <span class="comment">% tempSet = sort(tempSet);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">                    <span class="mxinfo " id="T14:U195"><span class="var type1" id="S29T14U289">check</span> = <span class="mxinfo " id="T14:U197"><span class="mxinfo " id="T3:U198"><span class="var type1" id="S3T2U292">I</span>(<span class="var type1" id="S14T3U293">h</span>,<span class="var type1" id="S15T3U294">w</span>,<span class="var type1" id="S16T3U295">f</span>,<span class="var type1" id="S13T3U296">s</span>)</span> &gt; <span class="var type1" id="S28T13U297">tempSet</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">                    <span class="mxinfo " id="T3:U205"><span class="var type1" id="S30T3U300">type</span> = <span class="mxinfo " id="T3:U207">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T5:U208"><span class="mxinfo " id="T3:U209">sum(<span class="var type1" id="S29T14U307">check</span>)</span> &gt;= <span class="mxinfo " id="T3:U211"><span class="mxinfo " id="T3:U212">0.97</span>*<span class="mxinfo " id="T3:U213">80</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">                        <span class="comment">% fprintf('Maxima Detected\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">                        <span class="mxinfo " id="T3:U214"><span class="var type1" id="S30T3U313">type</span> = <span class="mxinfo " id="T3:U216">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">                        <span class="mxinfo " id="T14:U217"><span class="var type1" id="S29T14U318">check</span> = <span class="mxinfo " id="T14:U219"><span class="mxinfo " id="T3:U220"><span class="var type1" id="S3T2U321">I</span>(<span class="var type1" id="S14T3U322">h</span>,<span class="var type1" id="S15T3U323">w</span>,<span class="var type1" id="S16T3U324">f</span>,<span class="var type1" id="S13T3U325">s</span>)</span> &lt; <span class="var type1" id="S28T13U326">tempSet</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo " id="T5:U227"><span class="mxinfo " id="T3:U228">sum(<span class="var type1" id="S29T14U332">check</span>)</span> &gt;= <span class="mxinfo " id="T3:U230"><span class="mxinfo " id="T3:U231">0.97</span>*<span class="mxinfo " id="T3:U232">80</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">                            <span class="mxinfo " id="T3:U233"><span class="var type1" id="S30T3U338">type</span> = <span class="mxinfo " id="T3:U235">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T5:U236"><span class="var type1" id="S30T3U343">type</span> ~= <span class="mxinfo " id="T3:U238">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">                        <span class="mxinfo " id="T1:U239"><span class="var type1" id="S2T1U347">keyPoints</span> = <span class="mxinfo " id="T1:U241">[<span class="var type1" id="S2T1U350">keyPoints</span>; <span class="mxinfo " id="T15:U243">[<span class="var type1" id="S4T3U354">o</span>, <span class="var type1" id="S13T3U355">s</span>, <span class="var type1" id="S14T3U356">h</span>, <span class="var type1" id="S15T3U357">w</span>, <span class="var type1" id="S16T3U358">f</span>, <span class="var type1" id="S30T3U359">type</span>]</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">                        <span class="comment">% disp([o,s,h,w,f, type]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">                    <span class="comment">% Go to Next Pixel</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
