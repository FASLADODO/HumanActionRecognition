<pre class="code">
<span class="srcline"><span class="lineno"><a href="83,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">mag</span>, <span class="var type1" id="S3T72U4">vect</span>] = GetGradOri_vector(<span class="var type1" id="S4T4U7">pix</span>,<span class="var type1" id="S5T5U8">r</span>,<span class="var type1" id="S6T5U9">c</span>,<span class="var type1" id="S7T5U10">s</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T2:U7">[<span class="var type1" id="S8T2U14">rows</span>, <span class="var type1" id="S9T2U15">cols</span>, <span class="var type1" id="S10T2U16">slices</span>] = size(<span class="var type1" id="S4T4U19">pix</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U12"><span class="var type1" id="S5T5U23">r</span> &lt; <span class="mxinfo " id="T2:U14">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,6" id="srcline6"> 6</a></span><span class="line">    <span class="comment">% r = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,7" id="srcline7"> 7</a></span><span class="line">    <span class="var type1" id="S5T5U27">r</span> = cast(1,<span class="string">'int16'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="83,8" id="srcline8"> 8</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,9" id="srcline9"> 9</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U16"><span class="var type1" id="S6T5U35">c</span> &lt; <span class="mxinfo " id="T2:U18">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,10" id="srcline10">10</a></span><span class="line">    <span class="comment">% c = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,11" id="srcline11">11</a></span><span class="line">    <span class="var type1" id="S6T5U39">c</span> = cast(1,<span class="string">'int16'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="83,12" id="srcline12">12</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,13" id="srcline13">13</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U20"><span class="var type1" id="S7T5U47">s</span> &lt; <span class="mxinfo " id="T2:U22">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,14" id="srcline14">14</a></span><span class="line">    <span class="comment">% s = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,15" id="srcline15">15</a></span><span class="line">    <span class="var type1" id="S7T5U51">s</span> = cast(1,<span class="string">'int16'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="83,16" id="srcline16">16</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,17" id="srcline17">17</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U24"><span class="var type1" id="S5T5U59">r</span> &gt; <span class="var type1" id="S8T2U60">rows</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,18" id="srcline18">18</a></span><span class="line">    <span class="comment">% r = rows;</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T5:U27"><span class="var type1" id="S5T5U63">r</span> = <span class="mxinfo " id="T5:U29">cast(<span class="var type1" id="S8T2U66">rows</span>,<span class="string">'int16'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,20" id="srcline20">20</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,21" id="srcline21">21</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U31"><span class="var type1" id="S6T5U71">c</span> &gt; <span class="var type1" id="S9T2U72">cols</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% c = cols;</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T5:U34"><span class="var type1" id="S6T5U75">c</span> = <span class="mxinfo " id="T5:U36">cast(<span class="var type1" id="S9T2U78">cols</span>,<span class="string">'int16'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,24" id="srcline24">24</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,25" id="srcline25">25</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U38"><span class="var type1" id="S7T5U83">s</span> &gt; <span class="var type1" id="S10T2U84">slices</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,26" id="srcline26">26</a></span><span class="line">    <span class="comment">% s = slices;</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T5:U41"><span class="var type1" id="S7T5U87">s</span> = <span class="mxinfo " id="T5:U43">cast(<span class="var type1" id="S10T2U90">slices</span>,<span class="string">'int16'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,31" id="srcline31">31</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T10:U45"><span class="var type1" id="S6T5U96">c</span> == <span class="mxinfo " id="T2:U47">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo " id="T2:U48"><span class="var type1" id="S13T2U100">xgrad</span> = <span class="mxinfo " id="T2:U50"><span class="mxinfo " id="T2:U51">2.0</span> * (<span class="mxinfo " id="T2:U52"><span class="mxinfo " id="T2:U53">double(<span class="var type1" id="S4T4U108">pix</span>(<span class="var type1" id="S5T5U109">r</span>,<span class="mxinfo " id="T5:U56"><span class="var type1" id="S6T5U111">c</span>+<span class="mxinfo " id="T2:U58">1</span></span>,<span class="var type1" id="S7T5U113">s</span>))</span> - <span class="mxinfo " id="T2:U60">double(<span class="var type1" id="S4T4U117">pix</span>(<span class="var type1" id="S5T5U118">r</span>,<span class="var type1" id="S6T5U119">c</span>,<span class="var type1" id="S7T5U120">s</span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,33" id="srcline33">33</a></span><span class="line"><span class="keyword">elseif</span> (<span class="mxinfo " id="T10:U65"><span class="var type1" id="S6T5U124">c</span> == <span class="var type1" id="S9T2U125">cols</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T2:U68"><span class="var type1" id="S13T2U128">xgrad</span> = <span class="mxinfo " id="T2:U70"><span class="mxinfo " id="T2:U71">2.0</span> * (<span class="mxinfo " id="T2:U72"><span class="mxinfo " id="T2:U73">double(<span class="var type1" id="S4T4U136">pix</span>(<span class="var type1" id="S5T5U137">r</span>,<span class="var type1" id="S6T5U138">c</span>,<span class="var type1" id="S7T5U139">s</span>))</span> - <span class="mxinfo " id="T2:U78">double(<span class="var type1" id="S4T4U143">pix</span>(<span class="var type1" id="S5T5U144">r</span>,<span class="mxinfo " id="T5:U81"><span class="var type1" id="S6T5U146">c</span>-<span class="mxinfo " id="T2:U83">1</span></span>,<span class="var type1" id="S7T5U148">s</span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,35" id="srcline35">35</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T2:U85"><span class="var type1" id="S13T2U152">xgrad</span> = <span class="mxinfo " id="T2:U87"><span class="mxinfo " id="T2:U88">double(<span class="var type1" id="S4T4U157">pix</span>(<span class="var type1" id="S5T5U158">r</span>,<span class="mxinfo " id="T5:U91"><span class="var type1" id="S6T5U160">c</span>+<span class="mxinfo " id="T2:U93">1</span></span>,<span class="var type1" id="S7T5U162">s</span>))</span> - <span class="mxinfo " id="T2:U95">double(<span class="var type1" id="S4T4U166">pix</span>(<span class="var type1" id="S5T5U167">r</span>,<span class="mxinfo " id="T5:U98"><span class="var type1" id="S6T5U169">c</span>-<span class="mxinfo " id="T2:U100">1</span></span>,<span class="var type1" id="S7T5U171">s</span>))</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,37" id="srcline37">37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,38" id="srcline38">38</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T10:U102"><span class="var type1" id="S5T5U176">r</span> == <span class="mxinfo " id="T2:U104">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T2:U105"><span class="var type1" id="S15T2U180">ygrad</span> = <span class="mxinfo " id="T2:U107"><span class="mxinfo " id="T2:U108">2.0</span> * (<span class="mxinfo " id="T2:U109"><span class="mxinfo " id="T2:U110">double(<span class="var type1" id="S4T4U188">pix</span>(<span class="var type1" id="S5T5U189">r</span>,<span class="var type1" id="S6T5U190">c</span>,<span class="var type1" id="S7T5U191">s</span>))</span> - <span class="mxinfo " id="T2:U115">double(<span class="var type1" id="S4T4U195">pix</span>(<span class="mxinfo " id="T5:U117"><span class="var type1" id="S5T5U197">r</span>+<span class="mxinfo " id="T2:U119">1</span></span>,<span class="var type1" id="S6T5U199">c</span>,<span class="var type1" id="S7T5U200">s</span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,40" id="srcline40">40</a></span><span class="line"><span class="keyword">elseif</span> (<span class="mxinfo " id="T10:U122"><span class="var type1" id="S5T5U204">r</span> == <span class="var type1" id="S8T2U205">rows</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo " id="T2:U125"><span class="var type1" id="S15T2U208">ygrad</span> = <span class="mxinfo " id="T2:U127"><span class="mxinfo " id="T2:U128">2.0</span> * (<span class="mxinfo " id="T2:U129"><span class="mxinfo " id="T2:U130">double(<span class="var type1" id="S4T4U216">pix</span>(<span class="mxinfo " id="T5:U132"><span class="var type1" id="S5T5U218">r</span>-<span class="mxinfo " id="T2:U134">1</span></span>,<span class="var type1" id="S6T5U220">c</span>,<span class="var type1" id="S7T5U221">s</span>))</span> - <span class="mxinfo " id="T2:U137">double(<span class="var type1" id="S4T4U225">pix</span>(<span class="var type1" id="S5T5U226">r</span>,<span class="var type1" id="S6T5U227">c</span>,<span class="var type1" id="S7T5U228">s</span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,42" id="srcline42">42</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T2:U142"><span class="var type1" id="S15T2U232">ygrad</span> = <span class="mxinfo " id="T2:U144"><span class="mxinfo " id="T2:U145">double(<span class="var type1" id="S4T4U237">pix</span>(<span class="mxinfo " id="T5:U147"><span class="var type1" id="S5T5U239">r</span>-<span class="mxinfo " id="T2:U149">1</span></span>,<span class="var type1" id="S6T5U241">c</span>,<span class="var type1" id="S7T5U242">s</span>))</span> - <span class="mxinfo " id="T2:U152">double(<span class="var type1" id="S4T4U246">pix</span>(<span class="mxinfo " id="T5:U154"><span class="var type1" id="S5T5U248">r</span>+<span class="mxinfo " id="T2:U156">1</span></span>,<span class="var type1" id="S6T5U250">c</span>,<span class="var type1" id="S7T5U251">s</span>))</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,44" id="srcline44">44</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,45" id="srcline45">45</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T10:U159"><span class="var type1" id="S7T5U256">s</span> == <span class="mxinfo " id="T2:U161">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T2:U162"><span class="var type1" id="S16T2U260">zgrad</span> = <span class="mxinfo " id="T2:U164"><span class="mxinfo " id="T2:U165">2.0</span> * (<span class="mxinfo " id="T2:U166"><span class="mxinfo " id="T2:U167">double(<span class="var type1" id="S4T4U268">pix</span>(<span class="var type1" id="S5T5U269">r</span>,<span class="var type1" id="S6T5U270">c</span>,<span class="mxinfo " id="T5:U171"><span class="var type1" id="S7T5U272">s</span>+<span class="mxinfo " id="T2:U173">1</span></span>))</span> - <span class="mxinfo " id="T2:U174">double(<span class="var type1" id="S4T4U277">pix</span>(<span class="var type1" id="S5T5U278">r</span>,<span class="var type1" id="S6T5U279">c</span>,<span class="var type1" id="S7T5U280">s</span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,47" id="srcline47">47</a></span><span class="line"><span class="keyword">elseif</span> (<span class="mxinfo " id="T10:U179"><span class="var type1" id="S7T5U284">s</span> == <span class="var type1" id="S10T2U285">slices</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="83,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T2:U182"><span class="var type1" id="S16T2U288">zgrad</span> = <span class="mxinfo " id="T2:U184"><span class="mxinfo " id="T2:U185">2.0</span> * (<span class="mxinfo " id="T2:U186"><span class="mxinfo " id="T2:U187">double(<span class="var type1" id="S4T4U296">pix</span>(<span class="var type1" id="S5T5U297">r</span>,<span class="var type1" id="S6T5U298">c</span>,<span class="var type1" id="S7T5U299">s</span>))</span> - <span class="mxinfo " id="T2:U192">double(<span class="var type1" id="S4T4U303">pix</span>(<span class="var type1" id="S5T5U304">r</span>,<span class="var type1" id="S6T5U305">c</span>,<span class="mxinfo " id="T5:U196"><span class="var type1" id="S7T5U307">s</span>-<span class="mxinfo " id="T2:U198">1</span></span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,49" id="srcline49">49</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T2:U199"><span class="var type1" id="S16T2U312">zgrad</span> = <span class="mxinfo " id="T2:U201"><span class="mxinfo " id="T2:U202">double(<span class="var type1" id="S4T4U317">pix</span>(<span class="var type1" id="S5T5U318">r</span>,<span class="var type1" id="S6T5U319">c</span>,<span class="mxinfo " id="T5:U206"><span class="var type1" id="S7T5U321">s</span>+<span class="mxinfo " id="T2:U208">1</span></span>))</span> - <span class="mxinfo " id="T2:U209">double(<span class="var type1" id="S4T4U326">pix</span>(<span class="var type1" id="S5T5U327">r</span>,<span class="var type1" id="S6T5U328">c</span>,<span class="mxinfo " id="T5:U213"><span class="var type1" id="S7T5U330">s</span>-<span class="mxinfo " id="T2:U215">1</span></span>))</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,51" id="srcline51">51</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T2:U216"><span class="var type1" id="S13T2U334">xgrad</span> = <span class="mxinfo " id="T2:U218">double(<span class="var type1" id="S13T2U337">xgrad</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T2:U220"><span class="var type1" id="S15T2U340">ygrad</span> = <span class="mxinfo " id="T2:U222">double(<span class="var type1" id="S15T2U343">ygrad</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,55" id="srcline55">55</a></span><span class="line"><span class="mxinfo " id="T2:U224"><span class="var type1" id="S16T2U346">zgrad</span> = <span class="mxinfo " id="T2:U226">double(<span class="var type1" id="S16T2U349">zgrad</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,56" id="srcline56">56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo " id="T2:U228"><span class="var type1" id="S2T2U352">mag</span> = <span class="mxinfo " id="T2:U230">sqrt(<span class="mxinfo " id="T2:U231"><span class="mxinfo " id="T2:U232"><span class="mxinfo " id="T2:U233"><span class="var type1" id="S13T2U358">xgrad</span> * <span class="var type1" id="S13T2U359">xgrad</span></span> + <span class="mxinfo " id="T2:U236"><span class="var type1" id="S15T2U361">ygrad</span> * <span class="var type1" id="S15T2U362">ygrad</span></span></span> + <span class="mxinfo " id="T2:U239"><span class="var type1" id="S16T2U364">zgrad</span> * <span class="var type1" id="S16T2U365">zgrad</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,58" id="srcline58">58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="83,59" id="srcline59">59</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T10:U242"><span class="var type1" id="S2T2U369">mag</span> ~=<span class="mxinfo " id="T2:U244">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="83,60" id="srcline60">60</a></span><span class="line">    <span class="mxinfo " id="T72:U245"><span class="var type1" id="S3T72U373">vect</span> = <span class="mxinfo " id="T72:U247"><span class="mxinfo " id="T72:U248">[<span class="var type1" id="S13T2U377">xgrad</span> <span class="var type1" id="S15T2U378">ygrad</span> <span class="var type1" id="S16T2U379">zgrad</span>]</span> ./ <span class="var type1" id="S2T2U380">mag</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,61" id="srcline61">61</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="83,62" id="srcline62">62</a></span><span class="line">    <span class="mxinfo " id="T72:U253"><span class="var type1" id="S3T72U384">vect</span> = <span class="mxinfo " id="T72:U255">[<span class="mxinfo " id="T2:U256">1</span> <span class="mxinfo " id="T2:U257">0</span> <span class="mxinfo " id="T2:U258">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="83,63" id="srcline63">63</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
