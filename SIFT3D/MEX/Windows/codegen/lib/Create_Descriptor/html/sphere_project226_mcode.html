<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="62,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T7U3">V</span> = sphere_project(<span class="var type1" id="S3T7U6">v</span>,<span class="var type2" id="S4T2V1U7">r</span>,<span class="var type1" id="S5T64U8">c</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="62,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% sphere_project - project point X,Y,Z to the surface of sphere radius r</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% V = sphere_project(v,r,c)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% Cartesian inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% v is the vertex matrix, Nx3 (XYZ)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% r is the sphere radius, 1x1 (default 1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,10" id="srcline10">10</a></span><span class="line"><span class="comment">% c is the sphere centroid, 1x3 (default 0,0,0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,11" id="srcline11">11</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,12" id="srcline12">12</a></span><span class="line"><span class="comment">% XYZ are converted to spherical coordinates and their radius is</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,13" id="srcline13">13</a></span><span class="line"><span class="comment">% adjusted according to r, from c toward XYZ (defined with theta,phi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,14" id="srcline14">14</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,15" id="srcline15">15</a></span><span class="line"><span class="comment">% V is returned as Cartesian 3D coordinates</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,16" id="srcline16">16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,18" id="srcline18">18</a></span><span class="line"><span class="comment">% $Revision: 1.1 $ $Date: 2004/11/12 01:32:36 $</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,20" id="srcline20">20</a></span><span class="line"><span class="comment">% Licence:  GNU GPL, no implied or express warranties</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,21" id="srcline21">21</a></span><span class="line"><span class="comment">% History:  06/2002, Darren.Weber_at_radiology.ucsf.edu, created</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,22" id="srcline22">22</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,23" id="srcline23">23</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,24" id="srcline24">24</a></span><span class="line"><span class="comment"><span class="comment">%{</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="62,25" id="srcline25">25</a></span><span class="line"><span class="comment">if ~exist('v','var'),</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,26" id="srcline26">26</a></span><span class="line"><span class="comment">    msg = sprintf('SPHERE_PROJECT: No input vertices (X,Y,Z)\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,27" id="srcline27">27</a></span><span class="line"><span class="comment">    error(msg);</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,28" id="srcline28">28</a></span><span class="line"><span class="comment">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,29" id="srcline29">29</a></span><span class="line"><span class="comment"><span class="comment">%}</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="62,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T51:U5"><span class="var type1" id="S6T51U11">X</span> = <span class="mxinfo " id="T51:U7"><span class="var type1" id="S3T7U13">v</span>(<span class="mxinfo " id="T49:U9">:</span>,<span class="mxinfo " id="T2:U10">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T51:U11"><span class="var type1" id="S7T51U18">Y</span> = <span class="mxinfo " id="T51:U13"><span class="var type1" id="S3T7U20">v</span>(<span class="mxinfo " id="T49:U15">:</span>,<span class="mxinfo " id="T2:U16">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T51:U17"><span class="var type1" id="S8T51U25">Z</span> = <span class="mxinfo " id="T51:U19"><span class="var type1" id="S3T7U27">v</span>(<span class="mxinfo " id="T49:U21">:</span>,<span class="mxinfo " id="T2:U22">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,33" id="srcline33">33</a></span><span class="line"><span class="comment"><span class="comment">%{</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="62,34" id="srcline34">34</a></span><span class="line"><span class="comment">if ~exist('c','var'),</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,35" id="srcline35">35</a></span><span class="line"><span class="comment">    xo = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,36" id="srcline36">36</a></span><span class="line"><span class="comment">    yo = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,37" id="srcline37">37</a></span><span class="line"><span class="comment">    zo = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,38" id="srcline38">38</a></span><span class="line"><span class="comment">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,39" id="srcline39">39</a></span><span class="line"><span class="comment">    xo = c(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,40" id="srcline40">40</a></span><span class="line"><span class="comment">    yo = c(2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,41" id="srcline41">41</a></span><span class="line"><span class="comment">    zo = c(3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,42" id="srcline42">42</a></span><span class="line"><span class="comment">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,44" id="srcline44">44</a></span><span class="line"><span class="comment">if ~exist('r','var'), r = 1; end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,45" id="srcline45">45</a></span><span class="line"><span class="comment"><span class="comment">%}</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="62,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo " id="T2:U23"><span class="var type1" id="S9T2U32">xo</span> = <span class="mxinfo " id="T2:U25"><span class="var type1" id="S5T64U34">c</span>(<span class="mxinfo " id="T2:U27">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T2:U28"><span class="var type1" id="S10T2U38">yo</span> = <span class="mxinfo " id="T2:U30"><span class="var type1" id="S5T64U40">c</span>(<span class="mxinfo " id="T2:U32">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo " id="T2:U33"><span class="var type1" id="S11T2U44">zo</span> = <span class="mxinfo " id="T2:U35"><span class="var type1" id="S5T64U46">c</span>(<span class="mxinfo " id="T2:U37">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,49" id="srcline49">49</a></span><span class="line"><span class="comment">% alternate method is to use unit vector of V</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,50" id="srcline50">50</a></span><span class="line"><span class="comment">% [ n = 'magnitude(V)'; unitV = V ./ n; ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,51" id="srcline51">51</a></span><span class="line"><span class="comment">% to change the radius, multiply the unitV</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,52" id="srcline52">52</a></span><span class="line"><span class="comment">% by the radius required.  This avoids the</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,53" id="srcline53">53</a></span><span class="line"><span class="comment">% use of arctan functions, which have branches.</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,54" id="srcline54">54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,56" id="srcline56">56</a></span><span class="line"><span class="comment">% Convert Cartesian X,Y,Z to spherical (radians)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo " id="T51:U38"><span class="var type1" id="S12T51U50">theta</span> = <span class="mxinfo " id="T51:U40">atan2( (<span class="mxinfo " id="T51:U41"><span class="var type1" id="S7T51U55">Y</span>-<span class="var type1" id="S10T2U56">yo</span></span>), (<span class="mxinfo " id="T51:U44"><span class="var type1" id="S6T51U59">X</span>-<span class="var type1" id="S9T2U60">xo</span></span>) )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T51:U47"><span class="var type1" id="S14T51U63">phi</span>   = <span class="mxinfo " id="T51:U49">atan2( <span class="mxinfo " id="T51:U50">sqrt( <span class="mxinfo " id="T51:U51"><span class="mxinfo " id="T51:U52">(<span class="mxinfo " id="T51:U53"><span class="var type1" id="S6T51U72">X</span>-<span class="var type1" id="S9T2U73">xo</span></span>).^2</span> + <span class="mxinfo " id="T51:U56">(<span class="mxinfo " id="T51:U57"><span class="var type1" id="S7T51U78">Y</span>-<span class="var type1" id="S10T2U79">yo</span></span>).^2</span></span> )</span>, (<span class="mxinfo " id="T51:U60"><span class="var type1" id="S8T51U83">Z</span>-<span class="var type1" id="S11T2U84">zo</span></span>) )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,59" id="srcline59">59</a></span><span class="line"><span class="comment">% do not calc: r = sqrt( (X-xo).^2 + (Y-yo).^2 + (Z-zo).^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,61" id="srcline61">61</a></span><span class="line"><span class="comment">%   Recalculate X,Y,Z for constant r, given theta &amp; phi.</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,62" id="srcline62">62</a></span><span class="line"><span class="mxinfo " id="T51:U63"><span class="var type1" id="S16T51U87">R</span> = <span class="mxinfo " id="T51:U65"><span class="mxinfo " id="T51:U66">ones(<span class="mxinfo " id="T68:U67">size(<span class="var type1" id="S14T51U93">phi</span>)</span>)</span> * <span class="var type1" id="S4T2U94">r</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,63" id="srcline63">63</a></span><span class="line"><span class="mxinfo " id="T51:U70"><span class="var type1" id="S19T51U97">x</span> = <span class="mxinfo " id="T51:U72"><span class="mxinfo " id="T51:U73"><span class="var type1" id="S16T51U100">R</span> .* <span class="mxinfo " id="T51:U75">sin(<span class="var type1" id="S14T51U103">phi</span>)</span></span> .* <span class="mxinfo " id="T51:U77">cos(<span class="var type1" id="S12T51U106">theta</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,64" id="srcline64">64</a></span><span class="line"><span class="mxinfo " id="T51:U79"><span class="var type1" id="S22T51U109">y</span> = <span class="mxinfo " id="T51:U81"><span class="mxinfo " id="T51:U82"><span class="var type1" id="S16T51U112">R</span> .* <span class="mxinfo " id="T51:U84">sin(<span class="var type1" id="S14T51U115">phi</span>)</span></span> .* <span class="mxinfo " id="T51:U86">sin(<span class="var type1" id="S12T51U118">theta</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,65" id="srcline65">65</a></span><span class="line"><span class="mxinfo " id="T51:U88"><span class="var type1" id="S23T51U121">z</span> = <span class="mxinfo " id="T51:U90"><span class="var type1" id="S16T51U123">R</span> .* <span class="mxinfo " id="T51:U92">cos(<span class="var type1" id="S14T51U126">phi</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,66" id="srcline66">66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,67" id="srcline67">67</a></span><span class="line"><span class="mxinfo " id="T7:U94"><span class="var type1" id="S2T7U129">V</span> = <span class="mxinfo " id="T7:U96">[<span class="var type1" id="S19T51U132">x</span> <span class="var type1" id="S22T51U133">y</span> <span class="var type1" id="S23T51U134">z</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,68" id="srcline68">68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="62,69" id="srcline69">69</a></span><span class="line"><span class="keyword">return</span></span></span>
</pre>
